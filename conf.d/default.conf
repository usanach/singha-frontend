# config to don't allow the browser to render the page inside an frame or iframe
# and avoid clickjacking http://en.wikipedia.org/wiki/Clickjacking
# if you need to allow [i]frames, you can use SAMEORIGIN or even set an uri with ALLOW-FROM uri
# https://developer.mozilla.org/en-US/docs/HTTP/X-Frame-Options
add_header X-Frame-Options SAMEORIGIN;

# when serving user-supplied content, include a X-Content-Type-Options: nosniff header along with the Content-Type: header,
# to disable content-type sniffing on some browsers.
# https://www.owasp.org/index.php/List_of_useful_HTTP_headers
# currently suppoorted in IE > 8 http://blogs.msdn.com/b/ie/archive/2008/09/02/ie8-security-part-vi-beta-2-update.aspx
# http://msdn.microsoft.com/en-us/library/ie/gg622941(v=vs.85).aspx
# 'soon' on Firefox https://bugzilla.mozilla.org/show_bug.cgi?id=471020
add_header X-Content-Type-Options nosniff;

# This header enables the Cross-site scripting (XSS) filter built into most recent web browsers.
# It's usually enabled by default anyway, so the role of this header is to re-enable the filter for 
# this particular website if it was disabled by the user.
# https://www.owasp.org/index.php/List_of_useful_HTTP_headers
add_header X-XSS-Protection "1; mode=block";

    
# config to enable HSTS(HTTP Strict Transport Security) https://developer.mozilla.org/en-US/docs/Security/HTTP_Strict_Transport_Security
# to avoid ssl stripping https://en.wikipedia.org/wiki/SSL_stripping#SSL_stripping
# also https://hstspreload.org/
add_header Strict-Transport-Security "max-age=31536000; includeSubdomains; preload";

server {
    listen       80;
    listen  [::]:80;
    server_name  localhost;
    
    root   /usr/share/nginx/html;
    index  index.php index.html index.htm;
    
    location /leadadmin {

        alias /usr/share/nginx/html/singha-members/public;
        
        index  index.php index.html index.htm;
        
        # ถ้าขอ /leadadmin ตรงๆ ให้คืนค่า 404
        if ($request_uri = "/leadadmin") {
            return 404;
        }

        try_files $uri $uri/ @leadadmin;

        location ~ \.php$ {
            fastcgi_pass 127.0.0.1:9000;
            fastcgi_param SCRIPT_FILENAME /usr/share/nginx/html/singha-members/public/index.php;
            include fastcgi_params;
            include /etc/nginx/conf.d/php_settings.conf;

            fastcgi_hide_header Server;
            add_header X-App-Version "1.0.0";

            fastcgi_param HTTP_X_FORWARDED_HOST "";
            fastcgi_param HTTP_X_FORWARDED_SERVER "";
        }
    }

    location @leadadmin {
        rewrite ^/leadadmin/(.*)$ /leadadmin/index.php last;
    }

	rewrite ^(/.*)\.html(\?.*)?$ $1$2;
	rewrite ^/(.*)/$ /$1;

	try_files $uri/index.html $uri.html $uri/ $uri =404;
    
    location ~ \.php$ {
        fastcgi_pass 127.0.0.1:9000;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
        include /etc/nginx/conf.d/php_settings.conf;
        
        fastcgi_hide_header Server;
        add_header X-App-Version "1.0.0";
        
        fastcgi_param HTTP_X_FORWARDED_HOST "";
        fastcgi_param HTTP_X_FORWARDED_SERVER "";
    }

 	location ~ /\.git {
    		deny all;
    		return 404;
  	}

  	# or, all . directories/files in general (including .htaccess, etc)

  	location ~ /\. {
    		deny all;
    		return 404;
  	}

	location = / {
        	return 302 /th;
    	}

    # Redirect requests for .html files to clean URLs (without .html)
    if ($request_uri ~ ^/(.*)\.html$) {
        return 302 /$1;
    }

    # Serve the .html file if it exists
    location / {
        try_files $uri $uri.html $uri/ =404;
    }
    
    location /singlehouse/ {
        rewrite ^/singlehouse/([a-zA-Z0-9_-]+)$ https://residential2.singhaestate.co.th/singlehouse/$1 redirect;
    }

    location /clusterhome/ {
        rewrite ^/clusterhome/([a-zA-Z0-9_-]+)$  https://residential2.singhaestate.co.th/clusterhome/$1 redirect;
    }

    location /condo/ {
        rewrite ^/condo/([a-zA-Z0-9_-]+)$  https://residential2.singhaestate.co.th/condo/$1 redirect;
    }

    location /privateestate/ {
        rewrite ^/privateestate/([a-zA-Z0-9_-]+)$  https://residential2.singhaestate.co.th/privateestate/$1 redirect;
    }

    location ~ ^/th/house_and_condo/condo(/[-a-zA-Z0-9_/]*)?$ {
        return 302 /th/condominium$1;
    }
    
    location ~ ^/en/house_and_condo/condo(/[-a-zA-Z0-9_/]*)?$ {
        return 302 /en/condominium$1;
    }
    
    location ~ ^/th/house_and_condo/house(/[-a-zA-Z0-9_/]*)?$ {
        return 302 /th/house$1;
    }
    
    location ~ ^/en/house_and_condo/house(/[-a-zA-Z0-9_/]*)?$ {
        return 302 /en/house$1;
    }
  
    location ~ ^/th/house/home-office(/[-a-zA-Z0-9_/]*)?$ {
        return 302 /th/house$1;
    }
    
    location ~ ^/en/house/home-office(/[-a-zA-Z0-9_/]*)?$ {
        return 302 /en/house$1;
    }
    
    location ~ ^/th/house/private-estate(/[-a-zA-Z0-9_/]*)?$ {
        return 302 /th/house$1;
    }
    
    location ~ ^/en/house/private-estate(/[-a-zA-Z0-9_/]*)?$ {
        return 302 /en/house$1;
    }
    
    location ~ ^/th/shawn(/[-a-zA-Z0-9_/]*)?$ {
        return 302 /th/house/detached-house/shawn$1;
    }
    
    location ~ ^/en/shawn(/[-a-zA-Z0-9_/]*)?$ {
        return 302 /en/house/detached-house/shawn$1;
    }
    
    location ~ ^/singlehouse/shawn/panya-indra/th(/[-a-zA-Z0-9_/]*)?$ {
        return 302 /th/house/detached-house/shawn/panya-indra$1;
    }
    
    location ~ ^/singlehouse/shawn/panya-indra/en(/[-a-zA-Z0-9_/]*)?$ {
        return 302 /en/house/detached-house/shawn/panya-indra$1;
    }
    
    location ~ ^/singlehouse/shawn/wongwaen-chatuchot/th(/[-a-zA-Z0-9_/]*)?$ {
        return 302 /th/house/detached-house/shawn/wongwaen-chatuchot$1;
    }
    
    location ~ ^/singlehouse/shawn/wongwaen-chatuchot/en(/[-a-zA-Z0-9_/]*)?$ {
        return 302 /en/house/detached-house/shawn/wongwaen-chatuchot$1;
    }
    
    location ~ ^/th/srin(/[-a-zA-Z0-9_/]*)?$ {
        return 302 /th/house/detached-house/srin$1;
    }
    
    location ~ ^/en/srin(/[-a-zA-Z0-9_/]*)?$ {
        return 302 /en/house/detached-house/srin$1;
    }
    
    location ~ ^/singlehouse/srin/ratchapruek-sai1/th(/[-a-zA-Z0-9_/]*)?$ {
        return 302 /th/house/detached-house/srin/ratchapruek-sai1$1;
    }
    
    location ~ ^/singlehouse/srin/ratchapruek-sai1/en(/[-a-zA-Z0-9_/]*)?$ {
        return 302 /en/house/detached-house/srin/ratchapruek-sai1$1;
    }
    
    location ~ ^/th/srin/prannok(/[-a-zA-Z0-9_/]*)?$ {
        return 302 /th/house/detached-house/srin/prannok$1;
    }
    
    location ~ ^/en/srin/prannok(/[-a-zA-Z0-9_/]*)?$ {
        return 302 /en/house/detached-house/srin/prannok$1;
    }
    
    location ~ ^/th/condo/the-extro/phayathai-rangnam(/[-a-zA-Z0-9_/]*)?$ {
        return 302 /th/condominium/the-extro/phayathai-rangnam$1;
    }
    
    location ~ ^/en/condo/the-extro/phayathai-rangnam(/[-a-zA-Z0-9_/]*)?$ {
        return 302 /en/condominium/the-extro/phayathai-rangnam$1;
    }

    location ~ ^/th/smyths(/[-a-zA-Z0-9_/]*)?$ {
        return 302 /th/house/private-estate/smyths$1;
    }
    
    location ~ ^/en/smyths(/[-a-zA-Z0-9_/]*)?$ {
        return 302 /en/house/private-estate/smyths$1;
    }
    
    location ~ ^/th/smyths/kaset-nawamin(/[-a-zA-Z0-9_/]*)?$ {
        return 302 /th/house/private-estate/smyths/kaset-nawamin$1;
    }
    
    location ~ ^/en/smyths/kaset-nawamin(/[-a-zA-Z0-9_/]*)?$ {
        return 302 /en/house/private-estate/smyths/kaset-nawamin$1;
    }
    
    location ~ ^/th/smyths/ramintra(/[-a-zA-Z0-9_/]*)?$ {
        return 302 /th/house/private-estate/smyths/ramintra$1;
    }
    
    location ~ ^/en/smyths/ramintra(/[-a-zA-Z0-9_/]*)?$ {
        return 302 /en/house/private-estate/smyths/ramintra$1;
    }   

    location ~ ^/th/collections(/[-a-zA-Z0-9_/]*)?$ {
        return 302 /th/collection$1;
    }
    
    location ~ ^/en/collections(/[-a-zA-Z0-9_/]*)?$ {
        return 302 /en/collection$1;
    }
    
    location ~ ^/th/contact-us/contact(/[-a-zA-Z0-9_/]*)?$ {
        return 302 /th/contact-us/head-office$1;
    }
    
    location ~ ^/en/contact-us/contact(/[-a-zA-Z0-9_/]*)?$ {
        return 302 /en/contact-us/head-office$1;
    }
    
    location ~ ^/th/contact-us/become-agent(/[-a-zA-Z0-9_/]*)?$ {
        return 302 /th/contact-us/partner-agent$1;
    }
    
    location ~ ^/en/contact-us/become-agent(/[-a-zA-Z0-9_/]*)?$ {
        return 302 /en/contact-us/partner-agent$1;
    }
    
    location ~ ^/clusterhome/smyth/ramintra(/[-a-zA-Z0-9_/]*)?$ {
        return 302 /th/house/private-estate/smyths/ramintra$1;
    }
    
    location ~ ^/th/houseth(/[-a-zA-Z0-9_/]*)?$ {
        return 302 /th/house$1;
    }
    
    location ~ ^/th/housesinglehouse/shawn/panya-indra(/[-a-zA-Z0-9_/]*)?$ {
        return 302 /th/house/detached-house/shawn/panya-indra$1;
    }
    
    location ~ ^/th/housesinglehouse/shawn/th(/[-a-zA-Z0-9_/]*)?$ {
        return 302 /th/house/detached-house/shawn$1;
    }
    
    location ~ ^/(en|th)/house/detached-house/srin/ratchapruek-sai1(/[-a-zA-Z0-9_/]*)?$ {        
        return 302 /$1/house/detached-house/srin/ratchaphruek-sai1$2$is_args$args;
    }

    rewrite ^/(th|en|chs)/homeoffice/([a-zA-Z0-9_-]+)$ https://residential2.singhaestate.co.th/$1/homeoffice/$2  break;
    rewrite ^/(th|en|chs)/clusterhome/([a-zA-Z0-9_-]+)$ https://residential2.singhaestate.co.th/$1/clusterhome/$2  break;
    rewrite ^/(th|en|chs)/singlehouse/([a-zA-Z0-9_-]+)$ https://residential2.singhaestate.co.th/$1/singlehouse/$2  break;
    rewrite ^/(th|en|chs)/condo/([a-zA-Z0-9_-]+)$ https://residential2.singhaestate.co.th/$1/condo/$2  break;
    rewrite ^/(th|en|chs)/promotion https://residential.singhaestate.co.th/$1/campaigns?$args  break;
    rewrite ^/(th|en|chs)/news https://www.singhaestate.co.th/$1/news-room?$args  break;
    rewrite ^/(th|en|chs)/agent https://residential.singhaestate.co.th/$1/contact-us/become-agent?$args  break;

    # Redirect "/th" and "/th/", "/en" and "/en/" to index.html
    rewrite ^/(th|en)?$ /page/home/index.html break;
    rewrite ^/(th|en)/?$ /page/home/index.html break;


    # Redirect "/th" and "/th/", "/en" and "/en/" to index.html
    rewrite ^/(th|en)/testhome?$ /page/home-prod/index.html break;
    rewrite ^/(th|en)/testhome/?$ /page/home-prod/index.html break;

    # Redirect for collections
    rewrite ^/(th|en)/collection?$ /page/collection/index.html break;
    rewrite ^/(th|en)/collection/?$ /page/collection/index.html break;

    # Redirect for stories
    rewrite ^/(th|en)/stories?$ /page/story/index.html break;
    rewrite ^/(th|en)/stories/?$ /page/story/index.html break;
    rewrite ^/(th|en)/stories/([^\s]+)/([^\s]+)?$ /page/story/detail/index.php break;
    rewrite ^/(th|en)/stories/([^\s]+)/([^\s]+)/?$ /page/story/detail/index.php break;
    rewrite ^/(th|en)/stories/([^\s]+)?$ /page/story/detail/index.php break;
    rewrite ^/(th|en)/stories/([^\s]+)/?$ /page/story/detail/index.php break;

    # Redirect for campaigns
    rewrite ^/(th|en)/campaigns?$ /page/campaignAll/index.html break;
    rewrite ^/(th|en)/campaigns/?$ /page/campaignAll/index.html break;
    rewrite ^/(th|en)/campaigns/([^\s]+)?$ /page/campaignAll/detail/index.php break;
    rewrite ^/(th|en)/campaigns/([^\s]+)/?$ /page/campaignAll/detail/index.php break;

    # Redirect for contact us
    rewrite ^/(th|en)/contact-us?$ /page/contact/index.html break;
    rewrite ^/(th|en)/contact-us/?$ /page/contact/index.html break;
    rewrite ^/(th|en)/contact-us/head-office?$ /page/contactUs/index.html break;
    rewrite ^/(th|en)/contact-us/head-office/?$ /page/contactUs/index.html break;
    rewrite ^/(th|en)/contact-us/partner-agent?$ /page/becomeAgent/index.html break;
    rewrite ^/(th|en)/contact-us/partner-agent/?$ /page/becomeAgent/index.html break;

    # Redirect for sitemap
    rewrite ^/(th|en)/sitemap?$ /page/sitemap/index.html break;
    rewrite ^/(th|en)/sitemap/?$ /page/sitemap/index.html break;

    # Redirect for smyths
    rewrite ^/(th|en)/house/private-estate/smyths?$ /page/smyth/index.html break;
    rewrite ^/(th|en)/house/private-estate/smyths/?$ /page/smyth/index.html break;
    
    # Redirect for smyths kaset-nawamin
    rewrite ^/(th|en)/house/private-estate/smyths/kaset-nawamin?$ /page/smyth/smyth-content-page/kaset-nawamin/index.html break;
    rewrite ^/(th|en)/house/private-estate/smyths/kaset-nawamin/?$ /page/smyth/smyth-content-page/kaset-nawamin/index.html break;
    
    # Redirect for smyths ramintra
    rewrite ^/(th|en)/house/private-estate/smyths/ramintra?$ /page/smyth/smyth-content-page/ramintra/index.html break;
    rewrite ^/(th|en)/house/private-estate/smyths/ramintra/?$ /page/smyth/smyth-content-page/ramintra/index.html break;
   
    # Redirect for srin
    rewrite ^/(th|en)/house/detached-house/srin?$ /page/srin/index.html break;
    rewrite ^/(th|en)/house/detached-house/srin/?$ /page/srin/index.html break;

    # Redirect for srin prannok
    rewrite ^/(th|en)/house/detached-house/srin/prannok?$ /page/srin/srin-content-page/prannok/index.html break;
    rewrite ^/(th|en)/house/detached-house/srin/prannok/?$ /page/srin/srin-content-page/prannok/index.html break;

    # Redirect for sai 1
    rewrite ^/(th|en)/house/detached-house/srin/ratchaphruek-sai1?$ /page/srin/srin-content-page/rachapuek/index.html break;
    rewrite ^/(th|en)/house/detached-house/srin/ratchaphruek-sai1/?$ /page/srin/srin-content-page/rachapuek/index.html break;
    
    # Redirect for shawn 
    rewrite ^/(th|en)/house/detached-house/shawn?$ /page/shawn/index.html break;
    rewrite ^/(th|en)/house/detached-house/shawn/?$ /page/shawn/index.html break;

    # Redirect for shawn wongwaen
    rewrite ^/(th|en)/house/detached-house/shawn/wongwaen-chatuchot?$ /page/shawn/shawn-content-page/shawn-wongwaen/index.html break;
    rewrite ^/(th|en)/house/detached-house/shawn/wongwaen-chatuchot/?$ /page/shawn/shawn-content-page/shawn-wongwaen/index.html break;

    # Redirect for shawn panya
    rewrite ^/(th|en)/house/detached-house/shawn/panya-indra?$ /page/shawn/shawn-content-page/shawn-panya/index.html break;
    rewrite ^/(th|en)/house/detached-house/shawn/panya-indra/?$ /page/shawn/shawn-content-page/shawn-panya/index.html break;

    # Redirect for house
    rewrite ^/(th|en)/house?$ /page/house_and_condo/page/house/index.html break;
    rewrite ^/(th|en)/house/?$ /page/house_and_condo/page/house/index.html break;

    # Redirect for condo
    rewrite ^/(th|en)/condominium?$ /page/house_and_condo/page/condo/index.html break;
    rewrite ^/(th|en)/condominium/?$ /page/house_and_condo/page/condo/index.html break;

    # Redirect for the extro
    rewrite ^/(th|en)/condominium/the-extro/phayathai-rangnam?$ /page/the-extro/the-extro/the-extro/index.html break;
    rewrite ^/(th|en)/condominium/the-extro/phayathai-rangnam/?$ /page/the-extro/the-extro/the-extro/index.html break;

    rewrite ^/(th|en)/house/detached-house/siraninn?$ /page/siraninn/siraninn-page/index.html break;
    rewrite ^/(th|en)/house/detached-house/siraninn/?$ /page/siraninn/siraninn-page/index.html break;

    rewrite ^/(th|en)/house/detached-house/santiburi-the-residences?$ /page/santiburi/santiburi-page/index.html break;
    rewrite ^/(th|en)/house/detached-house/santiburi-the-residences/?$ /page/santiburi/santiburi-page/index.html break;

    rewrite ^/(th|en)/house/home-office/sentre/pattanakarn?$ /page/sentre/sentre-pattanakarn-page/index.html break;
    rewrite ^/(th|en)/house/home-office/sentre/pattanakarn/?$ /page/sentre/sentre-pattanakarn-page/index.html break;

    rewrite ^/(th|en)/house/private-estate/lasoiedes/sukhumvit43?$ /page/la-soie-de-s/la-soie-de-s-page/index.html break;
    rewrite ^/(th|en)/house/private-estate/lasoiedes/sukhumvit43/?$ /page/la-soie-de-s/la-soie-de-s-page/index.html break;

	rewrite ^/(th|en)/condominium/the-esse/sukhumvit36?$ /page/the-esse/the-esse-page/the-esse-36/index.html break;
	rewrite ^/(th|en)/condominium/the-esse/sukhumvit36/?$ /page/the-esse/the-esse-page/the-esse-36/index.html break;
 
	rewrite ^/(th|en)/condominium/the-esse/singha-complex?$ /page/the-esse/the-esse-page/the-esse-complex/index.html break;
	rewrite ^/(th|en)/condominium/the-esse/singha-complex/?$ /page/the-esse/the-esse-page/the-esse-complex/index.html break;
 
	rewrite ^/(th|en)/condominium/the-esse/asoke?$ /page/the-esse/the-esse-page/the-esse-asoke/index.html break;
	rewrite ^/(th|en)/condominium/the-esse/asoke/?$ /page/the-esse/the-esse-page/the-esse-asoke/index.html break;
 
	rewrite ^/(th|en)/condominium/the-esse?$ /page/the-esse/index.html break;
	rewrite ^/(th|en)/condominium/the-esse/?$ /page/the-esse/index.html break;
 
	rewrite ^/(th|en)/about-s-residences?$ /page/about-s/index.html break;
	rewrite ^/(th|en)/about-s-residences/?$ /page/about-s/index.html break;
 }
