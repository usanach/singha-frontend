const progress = [
    {
        date: '2020-12-30',
        image: [
            './../../../assets/progress/2020-12-30/1.jpg',
            './../../../assets/progress/2020-12-30/2.jpg',
            './../../../assets/progress/2020-12-30/3.jpg',
        ],
        progress: {
            overall: '0.15',
            structure: '',
            system: '',
            architecture: '',
            facade: '',
            interior: '',
        }
    },
    {
        date: '2021-01-29',
        image: [
            './../../../assets/progress/2021-01-29/1.jpg',
            './../../../assets/progress/2021-01-29/2.jpg',
            './../../../assets/progress/2021-01-29/3.jpg',
        ],
        progress: {
            overall: '1.25',
            structure: '',
            system: '',
            architecture: '',
            facade: '',
            interior: '',
        }
    },
    {
        date: '2021-02-28',
        image: [
            './../../../assets/progress/2021-02-28/1.jpg',
            './../../../assets/progress/2021-02-28/2.jpg',
            './../../../assets/progress/2021-02-28/3.jpg',
        ],
        progress: {
            overall: '2.53',
            structure: '',
            system: '',
            architecture: '',
            facade: '',
            interior: '',
        }
    },
    {
        date: '2021-03-31',
        image: [
            './../../../assets/progress/2021-03-31/1.jpg',
            './../../../assets/progress/2021-03-31/2.jpg',
            './../../../assets/progress/2021-03-31/3.jpg',
        ],
        progress: {
            overall: '2.53',
            structure: '',
            system: '',
            architecture: '',
            facade: '',
            interior: '',
        }
    },
    {
        date: '2021-04-30',
        image: [
            './../../../assets/progress/2021-03-31/1.jpg',
        ],
        progress: {
            overall: '2.53',
            structure: '',
            system: '',
            architecture: '',
            facade: '',
            interior: '',
        }
    },
    {
        date: '2021-05-31',
        image: [
            './../../../assets/progress/2021-05-31/1.jpg',
            './../../../assets/progress/2021-05-31/2.jpg',
            './../../../assets/progress/2021-05-31/3.jpg',
            './../../../assets/progress/2021-05-31/4.jpg',
        ],
        progress: {
            overall: '3.61',
            structure: '',
            system: '',
            architecture: '',
            facade: '',
            interior: '',
        }
    },
    {
        date: '2021-06-30',
        image: [
            './../../../assets/progress/2021-06-30/1.jpg',
            './../../../assets/progress/2021-06-30/2.jpg',
            './../../../assets/progress/2021-06-30/3.jpg',
            './../../../assets/progress/2021-06-30/4.jpg',
        ],
        progress: {
            overall: '3.94',
            structure: '',
            system: '',
            architecture: '',
            facade: '',
            interior: '',
        }
    },
    {
        date: '2021-07-31',
        image: [
            './../../../assets/progress/2021-07-31/1.jpg',
            './../../../assets/progress/2021-07-31/2.jpg',
            './../../../assets/progress/2021-07-31/3.jpg',
            './../../../assets/progress/2021-07-31/4.jpg',
        ],
        progress: {
            overall: '4.10',
            structure: '',
            system: '',
            architecture: '',
            facade: '',
            interior: '',
        }
    },
    {
        date: '2021-08-31',
        image: [
            './../../../assets/progress/2021-08-31/1.jpg',
            './../../../assets/progress/2021-08-31/2.jpg',
            './../../../assets/progress/2021-08-31/3.jpg',
            './../../../assets/progress/2021-08-31/4.jpg',
            './../../../assets/progress/2021-08-31/5.jpg',
            './../../../assets/progress/2021-08-31/6.jpg',
        ],
        progress: {
            overall: '4.70',
            structure: '',
            system: '',
            architecture: '',
            facade: '',
            interior: '',
        }
    },
    {
        date: '2021-09-30',
        image: [
            './../../../assets/progress/2021-09-30/1.jpg',
            './../../../assets/progress/2021-09-30/2.jpg',
            './../../../assets/progress/2021-09-30/3.jpg',
            './../../../assets/progress/2021-09-30/4.jpg',
            './../../../assets/progress/2021-09-30/5.jpg',
            './../../../assets/progress/2021-09-30/6.jpg',
        ],
        progress: {
            overall: '4.95',
            structure: '',
            system: '',
            architecture: '',
            facade: '',
            interior: '',
        }
    },
    {
        date: '2021-10-29',
        image: [
            './../../../assets/progress/2021-10-29/1.jpg',
            './../../../assets/progress/2021-10-29/2.jpg',
        ],
        progress: {
            overall: '5.50',
            structure: '',
            system: '',
            architecture: '',
            facade: '',
            interior: '',
        }
    },
    {
        date: '2021-11-30',
        image: [
            './../../../assets/progress/2021-11-30/1.jpg',
            './../../../assets/progress/2021-11-30/2.jpg',
            './../../../assets/progress/2021-11-30/3.jpg',
            './../../../assets/progress/2021-11-30/4.jpg',
        ],
        progress: {
            overall: '7.15',
            structure: '71.00',
            system: '',
            architecture: '',
            facade: '',
            interior: '',
        }
    },
    {
        date: '2021-12-31',
        image: [
            './../../../assets/progress/2021-12-31/1.jpg',
            './../../../assets/progress/2021-12-31/2.jpg',
            './../../../assets/progress/2021-12-31/3.jpg',
            './../../../assets/progress/2021-12-31/4.jpg',
            './../../../assets/progress/2021-12-31/5.jpg',
        ],
        progress: {
            overall: '7.96',
            structure: '78.00',
            system: '',
            architecture: '',
            facade: '',
            interior: '',
        }
    },
    {
        date: '2022-01-31',
        image: [
            './../../../assets/progress/2022-01-31/1.jpg',
            './../../../assets/progress/2022-01-31/2.jpg',
            './../../../assets/progress/2022-01-31/3.jpg',
            './../../../assets/progress/2022-01-31/4.jpg',
            './../../../assets/progress/2022-01-31/5.jpg',
        ],
        progress: {
            overall: '8.02',
            structure: '80.00',
            system: '',
            architecture: '',
            facade: '',
            interior: '',
        }
    },
    {
        date: '2022-02-28',
        image: [
            './../../../assets/progress/2022-02-28/1.jpg',
            './../../../assets/progress/2022-02-28/2.jpg',
            './../../../assets/progress/2022-02-28/3.jpg',
            './../../../assets/progress/2022-02-28/4.jpg',
            './../../../assets/progress/2022-02-28/5.jpg',
            './../../../assets/progress/2022-02-28/6.jpg',
        ],
        progress: {
            overall: '8.50',
            structure: '100.00',
            system: '',
            architecture: '',
            facade: '',
            interior: '',
        }
    },
];

let sortedProgress;
let gallerySlider;
let swiperThumbs;
let gallerySliderDesktop;
let swiperThumbsDesktop;

document.addEventListener('DOMContentLoaded', () => {
    sortedProgress = progress.sort((a, b) => new Date(b.date) - new Date(a.date));

    function formatDate(dateString) {
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        return new Date(dateString).toLocaleDateString('en-US', options);
    }

    function formatDateNoDay(dateString) {
        const options = { year: 'numeric', month: 'long'};
        return new Date(dateString).toLocaleDateString('en-US', options);
    }

    function initializeSwipers() {
        swiperThumbs = new Swiper('#swiper6progress-thumbs', {
            spaceBetween: 10,
            slidesPerView: 3,
            freeMode: true,
            watchSlidesVisibility: true,
            watchSlidesProgress: true,
        });

        gallerySlider = new Swiper('#swiper6progress-slider', {
            spaceBetween: 10,
            slidesPerView: 1,
            loop: true,
            navigation: {
                nextEl: '.swiper-thumb-wrapper.is-mobile .button-next',
                prevEl: '.swiper-thumb-wrapper.is-mobile .button-prev',
            },
            thumbs: {
                swiper: swiperThumbs,
            },
            on: {
                init: function () {
                    updateProgress2(this);
                },
                slideChange: function () {
                    updateProgress2(this);
                }
            }
        });

        swiperThumbsDesktop = new Swiper('#swiper5progress-thumbs', {
            spaceBetween: 10,
            slidesPerView: 3,
            freeMode: true,
            watchSlidesVisibility: true,
            watchSlidesProgress: true,
        });

        gallerySliderDesktop = new Swiper('#swiper5progress-slider', {
            spaceBetween: 10,
            slidesPerView: 1,
            loop: true,
            navigation: {
                nextEl: '.swiper-thumb-wrapper.is-mobile-hide .button-next',
                prevEl: '.swiper-thumb-wrapper.is-mobile-hide .button-prev',
            },
            thumbs: {
                swiper: swiperThumbsDesktop,
            },
            on: {
                init: function () {
                    updateProgress1(this);
                },
                slideChange: function () {
                    updateProgress1(this);
                }
            }
        });
    }

    function destroySwipers() {
        if (swiperThumbs) swiperThumbs.destroy(true, true);
        if (gallerySlider) gallerySlider.destroy(true, true);
        if (swiperThumbsDesktop) swiperThumbsDesktop.destroy(true, true);
        if (gallerySliderDesktop) gallerySliderDesktop.destroy(true, true);
    }

    function updateContent(selectedData) {
        document.querySelector('.progress-bar-show-all-text').textContent = `${selectedData.progress.overall}%`;
        const progressBars = document.querySelectorAll('.progress-bar-wrap');
        const progressLabels = ['structure', 'system', 'architecture', 'facade', 'interior'];
        progressLabels.forEach((label, index) => {
            const bar = progressBars[index];
            if (bar) {
                const progressNumberElement = bar.querySelector('.progress-process-number');
                const progressBarElement = bar.querySelector('.progress-fill');
                const value = selectedData.progress[label] || '0%';

                if (value === '0%' || value === '') {
                    bar.style.display = 'none';
                } else {
                    bar.style.display = 'block';
                    if (progressNumberElement) {
                        if (value == 100) {
                            
                            const intValue = Math.floor(value); 
                            progressNumberElement.textContent = `${intValue}%`;
                        } else {
                            progressNumberElement.textContent = `${value}%`;
                        }
                    }
                    if (progressBarElement) {
                        const progressValue = parseFloat(value.replace('%', ''));
                        progressBarElement.style.width = `${progressValue}%`;
                    }
                }
            }
        });

        const updateHeaderText = document.querySelector('.update-header-text');

        if (updateHeaderText) {
            updateHeaderText.textContent = 'Updated On ' + formatDateNoDay(selectedData.date);
        }

        const sliderWrapper = document.getElementById('swiper6progress-slider').querySelector('.swiper-wrapper');
        const thumbsWrapper = document.getElementById('swiper6progress-thumbs').querySelector('.swiper-wrapper');
        const sliderWrapperDesktop = document.getElementById('swiper5progress-slider').querySelector('.swiper-wrapper');
        const thumbsWrapperDesktop = document.getElementById('swiper5progress-thumbs').querySelector('.swiper-wrapper');

        sliderWrapper.innerHTML = '';
        thumbsWrapper.innerHTML = '';
        sliderWrapperDesktop.innerHTML = '';
        thumbsWrapperDesktop.innerHTML = '';

        selectedData.image.forEach((src) => {
            const slide = document.createElement('div');
            slide.className = 'swiper-slide';
            slide.innerHTML = `<img src="${src}" alt="">`;
            sliderWrapper.appendChild(slide);
            sliderWrapperDesktop.appendChild(slide.cloneNode(true));

            const thumb = document.createElement('div');
            thumb.className = 'swiper-slide';
            thumb.innerHTML = `<img src="${src}" alt="">`;
            thumbsWrapper.appendChild(thumb);
            thumbsWrapperDesktop.appendChild(thumb.cloneNode(true));
        });
        destroySwipers();
        initializeSwipers();
        updateProgress2(gallerySlider);
        updateProgress1(gallerySliderDesktop);
    }

    initializeSwipers();

    // const dropdown = document.getElementById('progress-date-dropdown');
    // if (dropdown) {
    //     sortedProgress.forEach(entry => {
    //         const option = document.createElement('option');
    //         option.value = entry.date;
    //         option.textContent = formatDate(entry.date);
    //         dropdown.appendChild(option);
    //     });

    //     const latestDate = sortedProgress[0].date;
    //     dropdown.value = latestDate;
    //     const selectedData = sortedProgress.find(entry => entry.date === latestDate);
    //     updateContent(selectedData);
    //     updateDescDetailVisibility();
    // }

    // if (dropdown) {
    //     dropdown.addEventListener('change', (event) => {
    //         const selectedDate = event.target.value;
    //         const selectedData = sortedProgress.find(entry => entry.date === selectedDate);
    //         updateContent(selectedData);
    //         updateDescDetailVisibility();
    //     });
    // }


    // ===========================================================

    const dateDropdown = document.getElementById('progress-date-dropdown');
    const updateHeaderText = document.querySelector('.update-header-text');
    const selectedDateBox = document.getElementById('selected-date');
    const dateList = document.getElementById('date-list');

    function formatDate(dateString) {
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        return new Date(dateString).toLocaleDateString('en-US', options);
    }

    function formatDate2(dateString) {
        const options = { year: 'numeric', month: 'long' };
        return new Date(dateString).toLocaleDateString('en-US', options);
    }

    progress.forEach(item => {
        const option = document.createElement('option');
        option.value = item.date;
        option.textContent = formatDate2(item.date); 
        dateDropdown.appendChild(option);

        const listItem = document.createElement('li');
        listItem.textContent = formatDate2(item.date); 
        listItem.setAttribute('data-value', item.date);
        dateList.appendChild(listItem);

        const latestDate = sortedProgress[0].date;
        const initlatestDate = formatDate(latestDate);
        selectedDateBox.innerHTML= `${initlatestDate}`;
    });

    selectedDateBox.addEventListener('click', () => {
        dateList.classList.toggle('show');
    });

    dateList.addEventListener('click', (event) => {
        const clickedItem = event.target;
        if (clickedItem.tagName === 'LI') {
            const selectedDate = clickedItem.getAttribute('data-value');
            selectedDateBox.textContent = clickedItem.textContent;
            dateDropdown.value = selectedDate;
            dateList.classList.remove('show');

            const selectedData = sortedProgress.find(entry => entry.date === selectedDate);
            updateContent(selectedData);

        }
    });

    document.addEventListener('click', (event) => {
        if (!event.target.closest('.custom-dropdown')) {
            dateList.classList.remove('show');
        }
    });

// ===========================================================

    const progressButton = document.querySelector('.progress-bar-button-text');
    const swiperThumbWrapper = document.querySelector('.swiper-thumb-wrapper');
    const updateDescDetail = document.querySelector('.update-desc-detail');
    const progressBars = document.querySelectorAll('.progress-bar-wrap');
    const visibleBars = Array.from(progressBars).filter(bar => getComputedStyle(bar).display === 'block');

    if (progressButton && swiperThumbWrapper && updateDescDetail) {
        progressButton.addEventListener('click', function () {
            progressButton.classList.toggle('active');
            swiperThumbWrapper.classList.toggle('active');

            if (visibleBars.length <= 2) {
                updateDescDetail.classList.add('active')
            } else {
                updateDescDetail.classList.toggle('active');
            }

            if (progressButton.classList.contains('active')) {
                progressButton.innerHTML = 'Minimize <img src="../../../assets/image-extro/btn-open-icon.svg" alt="arrow" />';
            } else {
                progressButton.innerHTML = 'PROGRESS PICTURE <img src="../../../assets/image-extro/btn-open-icon.svg" alt="arrow" />';
            }
        });
    }

    const button = document.getElementById('progress-bar2');
    const swiperWrapper = document.querySelector('.swiper-thumb-wrapper.is-mobile');
    const detailMobile = document.getElementById('detail-mobile');

    button.addEventListener('click', function () {
        button.classList.toggle('active');
        swiperWrapper.classList.toggle('active');
        detailMobile.classList.toggle('active');

        if (button.classList.contains('active')) {
            button.innerHTML = 'Minimize <img src="../../../assets/image-extro/btn-open-icon.svg" alt="arrow" />';
        } else {
            button.innerHTML = 'PROGRESS PICTURE <img src="../../../assets/image-extro/btn-open-icon.svg" alt="arrow" />';
        }
    });

    window.addEventListener('resize', updateDescDetailVisibility);
});

function updateProgress1(swiper) {
    const currentIndex = swiper.realIndex + 1;
    const totalSlides = swiper.slides.length;
    document.getElementById('peg').textContent = `${currentIndex}/${totalSlides}`;
}

function updateProgress2(swiper) {
    const currentIndex = swiper.realIndex + 1;
    const totalSlides = swiper.slides.length;
    document.getElementById('peg2').textContent = `${currentIndex}/${totalSlides}`;
}

function updateDescDetailVisibility() {
    const progressBars = document.querySelectorAll('.progress-bar-wrap');
    const visibleBars = Array.from(progressBars).filter(bar => getComputedStyle(bar).display === 'block');

    const updateDescDetail = document.querySelector('.update-desc-detail');
    const detailMobile = document.getElementById('detail-mobile');
    const button = document.getElementById('progress-bar2');


    if (visibleBars.length <= 2 && (window.screen.width > 1024 || window.innerWidth > 1024)) {
        updateDescDetail.classList.add('active');
        detailMobile.classList.remove('active');
    } else {
        updateDescDetail.classList.remove('active');
        detailMobile.classList.remove('active');
    }

    if ((window.screen.width <= 1024 || window.innerWidth <= 1024)) {
        if (document.querySelector('.swiper-thumb-wrapper.is-mobile')) {
            const swiperWrapper = document.querySelector('.swiper-thumb-wrapper.is-mobile');
            if (swiperWrapper.classList.contains('active')) {
                swiperWrapper.remove('active');
            }
            if (button.classList.contains('active')) {
                button.classList.remove('active');
                button.innerHTML = 'PROGRESS PICTURE <img src="../../../assets/image-extro/btn-open-icon.svg" alt="arrow" />';
            }
        }

    }
}